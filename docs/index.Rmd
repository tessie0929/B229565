---
title: 'Analysis of Mental Health Prescribing Across SIMD Deprivation Quintiles in Scotland (2024)'
output: html_document
date: "2025-11-14"
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, message = FALSE, warning = FALSE)
```

## Introduction
Mental health inequalities are a persistent public health concern in Scotland.
Socioeconomic deprivation, which measured using the Scottish Index of Multiple Deprivation (SIMD), is well known to correlate with higher prevalence of depression, anxiety, and severe mental illness.
This analysis examines whether GP-level prescribing of mental health medications reflects socioeconomic inequalities, focusing on all GP practices in Scotland in 2024, and assesses whether prescribing rates differ across SIMD quintiles and whether a clear socioeconomic gradient is observable.

```{r}
library(tidyverse)
library(here)
library(stringr)
```

## Loading Data Set

```{r}
files_2024 <- list.files(
  here("data", "2024"),
  pattern = "^pitc2024[0-9]{2}\\.csv$",
  full.names = TRUE
)
pitc2024_all <- map_dfr(files_2024, function(path) {
  pres <- read_csv(path, show_col_types = FALSE)
  if (!"DMDCode" %in% names(pres)) {
    pres <- pres %>% mutate(DMDCode = NA_character_)
  }
  pres %>% mutate(DMDCode = as.character(DMDCode))
})
```
SIMD Data Source: https://www.gov.scot/publications/scottish-index-of-multiple-deprivation-2020v2-postcode-look-up/
```{r}
GPlist_raw <- read_csv(here("data","practice_contactdetails_oct2024-open-data.csv"))
gp_info <- GPlist_raw %>% 
  select(PracticeCode, GPPracticeName, Postcode, PracticeListSize) %>% 
  mutate(
    Postcode_clean = str_remove_all(Postcode, " ") %>% str_to_upper()
  )

simd_raw <- read_csv(here("data", "SIMD+2020v2+-+postcode+lookup+-+updated+2025.csv"))
simd_info <- simd_raw %>% 
  mutate(
    Postcode_clean = str_remove_all(Postcode, " ") %>% str_to_upper()
  ) %>% 
  select(
    Postcode_clean,
    SIMD_quintile = SIMD2020_Quintile
  )
```
# Join table
```{r}
gp_simd <- gp_info %>%
  left_join(simd_info, join_by("Postcode_clean"))

pres_joined <- pitc2024_all %>% 
  left_join(
    gp_simd %>% 
      select(PracticeCode, GPPracticeName, PracticeListSize, SIMD_quintile),
    by = c("GPPractice" = "PracticeCode")
  ) %>% 
  mutate(
    year  = PaidDateMonth %/% 100,
    month = PaidDateMonth %% 100
  )
```

## Filtering Drugs
Drugs were confirmed according to BNFCode.
```{r}
mh_2024 <- pres_joined %>% 
  filter(
    str_starts(BNFItemCode, "0401") | 
    str_starts(BNFItemCode, "0402") |  
    str_starts(BNFItemCode, "0403")    
  ) %>% 
  mutate(
    drug_class = case_when(
      str_starts(BNFItemCode, "0401") ~ "Anxiolytics/Hypnotics",
      str_starts(BNFItemCode, "0402") ~ "Antipsychotics",
      str_starts(BNFItemCode, "0403") ~ "Antidepressants",
      TRUE ~ "Other"
    )
  )
```


```{r}
mh_rate_gp_2024 <- mh_2024 %>% 
  group_by(GPPractice, GPPracticeName, SIMD_quintile) %>% 
  summarise(
    items = sum(NumberOfPaidItems, na.rm = TRUE),
    list_size = first(PracticeListSize),
    .groups = "drop"
  ) %>% 
  mutate(
    rate_per_1000 = items / list_size * 1000
  ) %>%
  filter(!is.na(SIMD_quintile))

```


```{r}
mh_by_simd_2024 <- mh_rate_gp_2024 %>% 
  group_by(SIMD_quintile) %>% 
  summarise(
    mean_rate   = mean(rate_per_1000, na.rm = TRUE),
    median_rate = median(rate_per_1000, na.rm = TRUE),
    sd_rate     = sd(rate_per_1000, na.rm = TRUE),
    n_gp        = n(),
    .groups     = "drop"
  )
```

## Results
In 2024, there was a clear socioeconomic gradient in mental health prescribing.
GP practices located in the most deprived SIMD quintile had a mean of 2342 mental health prescriptions per 1000 registered patients, compared with 1384 per 1000 in the least deprived quintile.
This represents an absolute difference of about 958 prescriptions per 1000 patients, meaning that practices in the most deprived areas prescribed mental health medicines at roughly 1.7 times the rate of those in the least deprived areas.

## Plots
```{r}
mh_rate_gp_2024_clean <- mh_rate_gp_2024 %>%
  filter(!is.na(SIMD_quintile))

ggplot(mh_rate_gp_2024,
       aes(x = factor(SIMD_quintile), y = rate_per_1000)) +
  coord_cartesian(ylim = c(0, 5000)) +
  geom_boxplot() +
  labs(
    x = "SIMD quintile (1 = most deprived, 5 = least deprived)",
    y = "Mental health prescriptions per 1000 patients (2024)",
    title = "Mental health prescribing by socioeconomic deprivation",
    subtitle = "GP practices in Scotland, 2024"
  ) +
  theme_minimal() +
  theme(
    plot.title    = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5)
  )
```

SIMD quintile was strongly associated with prescribing rate (β = −226.7 prescriptions per 1000 patients per quintile increase, p < 0.001).
For each additional level of the SIMD quintile, the prescription rate decreases by approximately 227 prescriptions per 1000 patients on average.
```{r results='hide'}
model_2024 <- lm(rate_per_1000 ~ SIMD_quintile, data = mh_rate_gp_2024)
summary(model_2024)
```
